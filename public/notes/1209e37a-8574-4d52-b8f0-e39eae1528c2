:PROPERTIES:
:ID:       1209e37a-8574-4d52-b8f0-e39eae1528c2
:END:
#+title: 负载均衡
#+filetags: 高可用

负载均衡是高可用网络基础架构的关键组件，
通常用于将工作负载分布到多个服务器来提高网站、应用、数据库或其他服务的性能和可靠性。

而通过在后端引入一个负载均衡器和至少一个额外的 web 服务器，可以缓解这个故障。
通常情况下，所有的后端服务器会保证提供相同的内容，以便用户无论哪个服务器响应，都能收到一致的内容。

* 如何选择要转发的服务器
负载均衡器一般根据两个因素来决定要将请求转发到哪个服务器。
首先，确保所选择的服务器能够对请求做出响应，然后根据预先配置的规则从健康服务器池（healthy pool）中进行选择。

因为，负载均衡器应当只选择能正常做出响应的后端服务器，因此就需要有一种判断后端服务器是否「健康」的方法。
为了监视后台服务器的运行状况，运行状态检查服务会定期尝试使用转发规则定义的协议和端口去连接后端服务器。
如果，服务器无法通过健康检查，就会从池中剔除，保证流量不会被转发到该服务器，直到其再次通过健康检查为止。

* 负载均衡算法
- Round Robin(轮询): 为第一个请求选择列表中的第一个服务器, 然后按顺序向下, 循环
- Least Connections(最小连接): 优先选择连接数最小的服务器
- Source: 根据请求源的 IP 散列来选择要转发的服务器

  
* 其他要点
如果你的应用需要处理状态而要求用户能连接到和之前相同的服务器。
可以通过 Source 算法基于客户端的 IP 信息创建关联，或者使用粘性会话（sticky sessions）。

想要解决负载均衡器的单点故障问题，可以将第二个负载均衡器连接到第一个上，从而形成一个集群。

